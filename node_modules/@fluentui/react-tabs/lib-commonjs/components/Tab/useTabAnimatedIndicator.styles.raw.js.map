{"version":3,"sources":["../src/components/Tab/useTabAnimatedIndicator.styles.ts"],"sourcesContent":["import * as React from 'react';\nimport type { TabState, TabValue } from './Tab.types';\n\nimport { makeStyles, mergeClasses } from '@griffel/react';\nimport { useTabListContext_unstable } from '../TabList/TabListContext';\nimport { TabRegisterData } from '../TabList/TabList.types';\nimport { tokens } from '@fluentui/react-theme';\nimport { useAnimationFrame } from '@fluentui/react-utilities';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst tabIndicatorCssVars_unstable = {\n  offsetVar: '--fui-Tab__indicator--offset',\n  scaleVar: '--fui-Tab__indicator--scale',\n};\n\nconst useActiveIndicatorStyles = makeStyles({\n  base: {\n    // overflow is required to allow the selection indicator to animate outside the tab area.\n    overflow: 'visible',\n  },\n  animated: {\n    '::after': {\n      transitionProperty: 'transform',\n      transitionDuration: `${tokens.durationSlow}`,\n      transitionTimingFunction: `${tokens.curveDecelerateMax}`,\n    },\n    '@media (prefers-reduced-motion: reduce)': {\n      '::after': {\n        transitionProperty: 'none',\n        transitionDuration: '0.01ms',\n      },\n    },\n  },\n  horizontal: {\n    '::after': {\n      transformOrigin: 'left',\n      transform: `translateX(var(${tabIndicatorCssVars_unstable.offsetVar}))\n    scaleX(var(${tabIndicatorCssVars_unstable.scaleVar}))`,\n    },\n  },\n  vertical: {\n    '::after': {\n      transformOrigin: 'top',\n      transform: `translateY(var(${tabIndicatorCssVars_unstable.offsetVar}))\n        scaleY(var(${tabIndicatorCssVars_unstable.scaleVar}))`,\n    },\n  },\n});\n\nconst calculateTabRect = (element: HTMLElement) => {\n  if (element) {\n    const parentRect = element.parentElement?.getBoundingClientRect() || { x: 0, y: 0, width: 0, height: 0 };\n    const tabRect = element.getBoundingClientRect();\n\n    return {\n      x: tabRect.x - parentRect.x,\n      y: tabRect.y - parentRect.y,\n      width: tabRect.width,\n      height: tabRect.height,\n    };\n  }\n  return undefined;\n};\n\nconst getRegisteredTabRect = (registeredTabs: Record<string, TabRegisterData>, value?: TabValue) => {\n  const element = isValueDefined(value) ? registeredTabs[JSON.stringify(value)]?.ref.current : undefined;\n  return element ? calculateTabRect(element) : undefined;\n};\n\n// eslint-disable-next-line eqeqeq\nconst isValueDefined = (value: TabValue) => value != null;\n\n/**\n * Adds additional styling to the active tab selection indicator to create a sliding animation.\n */\nexport const useTabAnimatedIndicatorStyles_unstable = (state: TabState): TabState => {\n  const { disabled, selected, vertical } = state;\n\n  const activeIndicatorStyles = useActiveIndicatorStyles();\n  const [lastAnimatedFrom, setLastAnimatedFrom] = React.useState<TabValue>();\n  const [animationValues, setAnimationValues] = React.useState({ offset: 0, scale: 1 });\n  const getRegisteredTabs = useTabListContext_unstable(ctx => ctx.getRegisteredTabs);\n\n  const [requestAnimationFrame] = useAnimationFrame();\n\n  if (selected) {\n    const { previousSelectedValue, selectedValue, registeredTabs } = getRegisteredTabs();\n\n    if (isValueDefined(previousSelectedValue) && lastAnimatedFrom !== previousSelectedValue) {\n      const previousSelectedTabRect = getRegisteredTabRect(registeredTabs, previousSelectedValue);\n      const selectedTabRect = getRegisteredTabRect(registeredTabs, selectedValue);\n\n      if (selectedTabRect && previousSelectedTabRect) {\n        const offset = vertical\n          ? previousSelectedTabRect.y - selectedTabRect.y\n          : previousSelectedTabRect.x - selectedTabRect.x;\n\n        const scale = vertical\n          ? previousSelectedTabRect.height / selectedTabRect.height\n          : previousSelectedTabRect.width / selectedTabRect.width;\n\n        setAnimationValues({ offset, scale });\n        setLastAnimatedFrom(previousSelectedValue);\n\n        // Reset the animation values after the animation is complete\n        requestAnimationFrame(() => setAnimationValues({ offset: 0, scale: 1 }));\n      }\n    }\n  } else if (isValueDefined(lastAnimatedFrom)) {\n    // need to clear the last animated from so that if this tab is selected again\n    // from the same previous tab as last time, that animation still happens.\n    setLastAnimatedFrom(undefined);\n  }\n\n  // do not apply any animation if the tab is disabled\n  if (disabled) {\n    return state;\n  }\n\n  // the animation should only happen as the selection indicator returns to its\n  // original position and not when set at the previous tabs position.\n  const animating = animationValues.offset === 0 && animationValues.scale === 1;\n\n  state.root.className = mergeClasses(\n    state.root.className,\n    selected && activeIndicatorStyles.base,\n    selected && animating && activeIndicatorStyles.animated,\n    selected && (vertical ? activeIndicatorStyles.vertical : activeIndicatorStyles.horizontal),\n  );\n\n  const rootCssVars = {\n    [tabIndicatorCssVars_unstable.offsetVar]: `${animationValues.offset}px`,\n    [tabIndicatorCssVars_unstable.scaleVar]: `${animationValues.scale}`,\n  };\n\n  state.root.style = {\n    ...rootCssVars,\n    ...state.root.style,\n  };\n\n  return state;\n};\n"],"names":["useTabAnimatedIndicatorStyles_unstable","tabIndicatorCssVars_unstable","offsetVar","scaleVar","useActiveIndicatorStyles","makeStyles","base","overflow","animated","transitionProperty","transitionDuration","tokens","durationSlow","transitionTimingFunction","curveDecelerateMax","horizontal","transformOrigin","transform","vertical","calculateTabRect","element","parentRect","parentElement","getBoundingClientRect","x","y","width","height","tabRect","undefined","getRegisteredTabRect","registeredTabs","value","isValueDefined","JSON","stringify","ref","current","state","disabled","selected","activeIndicatorStyles","lastAnimatedFrom","setLastAnimatedFrom","React","useState","animationValues","setAnimationValues","offset","scale","getRegisteredTabs","useTabListContext_unstable","ctx","requestAnimationFrame","useAnimationFrame","previousSelectedValue","selectedValue","previousSelectedTabRect","selectedTabRect","animating","root","className","mergeClasses","rootCssVars","style"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}